<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Scripts and Hooks • projr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Scripts and Hooks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">projr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/get-started.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/how-to-guides.html">How-to guides</a></li>
    <li><a class="dropdown-item" href="../articles/environment.html">Environment Variables</a></li>
    <li><a class="dropdown-item" href="../articles/scripts-and-hooks.html">Scripts and Hooks</a></li>
    <li><a class="dropdown-item" href="../articles/concepts.html">Concepts</a></li>
    <li><a class="dropdown-item" href="../articles/design.html">Design</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
    <li><a class="dropdown-item" href="../BUILDLOG.html">Build log</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SATVILab/projr" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Scripts and Hooks</h1>
            
      

      <div class="d-none name"><code>scripts-and-hooks.Rmd</code></div>
    </div>

    
    
<p>Build scripts and hooks allow you to customize projr’s build process.
Scripts specify which documents to render, while hooks let you run
custom code before or after builds.</p>
<p>This documentation is modeled after <a href="https://quarto.org/docs/projects/environment.html" class="external-link">Quarto’s
environment variables documentation</a>, adapted for projr’s build
customization features.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>projr provides two key customization mechanisms:</p>
<ul>
<li>
<strong>Build scripts</strong> (<code>build.scripts</code>,
<code>dev.scripts</code>) - Control which documents/scripts are rendered
during builds</li>
<li>
<strong>Build hooks</strong> (<code>build.hooks</code>,
<code>dev.hooks</code>) - Run custom R scripts before or after the build
process</li>
</ul>
<p>Both are configured in <code>_projr.yml</code> and support separate
settings for production builds (versioned releases) and development
builds (iterative testing).</p>
<div class="section level3">
<h3 id="why-use-scripts-and-hooks">Why Use Scripts and Hooks?<a class="anchor" aria-label="anchor" href="#why-use-scripts-and-hooks"></a>
</h3>
<p><strong>Build scripts</strong> are useful when you want to:</p>
<ul>
<li>Explicitly control which documents are built instead of relying on
auto-detection</li>
<li>Build only a subset of documents (e.g., skip time-consuming analyses
during development)</li>
<li>Override Quarto or Bookdown project configurations</li>
</ul>
<p><strong>Build hooks</strong> are useful when you want to:</p>
<ul>
<li>Set up data or configuration before builds (e.g., download data,
check credentials)</li>
<li>Clean up or process outputs after builds (e.g., compress files, send
notifications)</li>
<li>Run validation checks or tests as part of the build process</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="build-scripts-configuration">Build Scripts Configuration<a class="anchor" aria-label="anchor" href="#build-scripts-configuration"></a>
</h2>
<p>Build scripts specify exactly which documents or scripts projr should
render during a build.</p>
<div class="section level3">
<h3 id="basic-structure">Basic Structure<a class="anchor" aria-label="anchor" href="#basic-structure"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Production build scripts</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> analysis.qmd</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> report.Rmd</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> data-processing.R</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># Development build scripts (optional, exclusive override)</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> quick-test.qmd</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> debug.R</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-behaviors">Key Behaviors<a class="anchor" aria-label="anchor" href="#key-behaviors"></a>
</h3>
<p><strong>Production builds</strong> (<code><a href="../reference/projr_build.html">projr_build_patch()</a></code>,
<code><a href="../reference/projr_build.html">projr_build_minor()</a></code>, <code><a href="../reference/projr_build.html">projr_build_major()</a></code>):</p>
<ul>
<li>Use <code>build.scripts</code> if specified</li>
<li>Fall back to <code>_quarto.yml</code> or <code>_bookdown.yml</code>
if no <code>build.scripts</code>
</li>
<li>Auto-detect documents if no configuration found</li>
</ul>
<p><strong>Development builds</strong>
(<code><a href="../reference/projr_build_dev.html">projr_build_dev()</a></code>):</p>
<ul>
<li>Use <code>dev.scripts</code> if specified</li>
<li>Fall back to <code>build.scripts</code> if no
<code>dev.scripts</code>
</li>
<li>Fall back to <code>_quarto.yml</code> or <code>_bookdown.yml</code>
if no scripts configuration</li>
<li>Auto-detect documents if no configuration found</li>
</ul>
<p><strong>Important</strong>: <code>dev.scripts</code> provides
<em>exclusive</em> control only when explicitly set. If you set
<code>dev.scripts</code>, it completely overrides
<code>build.scripts</code>. However, if <code>dev.scripts</code> is not
set at all, <code>build.scripts</code> will be used as a fallback.</p>
</div>
<div class="section level3">
<h3 id="script-priority-order">Script Priority Order<a class="anchor" aria-label="anchor" href="#script-priority-order"></a>
</h3>
<p>For <strong>production builds</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<code>file</code> parameter in build function (e.g.,
<code>projr_build_patch("specific.Rmd")</code>)</li>
<li>
<code>build.scripts</code> in <code>_projr.yml</code>
</li>
<li>Quarto project (<code>_quarto.yml</code>) or Bookdown project
(<code>_bookdown.yml</code>)</li>
<li>Auto-detection (finds <code>.Rmd</code>, <code>.qmd</code>,
<code>.R</code> files)</li>
</ol>
<p>For <strong>development builds</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<code>file</code> parameter in build function (e.g.,
<code>projr_build_dev("test.Rmd")</code>)</li>
<li>
<code>dev.scripts</code> in <code>_projr.yml</code>
</li>
<li>
<code>build.scripts</code> in <code>_projr.yml</code> (fallback if
no <code>dev.scripts</code>)</li>
<li>Quarto project (<code>_quarto.yml</code>) or Bookdown project
(<code>_bookdown.yml</code>)</li>
<li>Auto-detection</li>
</ol>
</div>
<div class="section level3">
<h3 id="file-format-requirements">File Format Requirements<a class="anchor" aria-label="anchor" href="#file-format-requirements"></a>
</h3>
<ul>
<li>Scripts must be specified as a <strong>plain character
vector</strong>
</li>
<li>File paths are relative to the project root</li>
<li>Paths can be absolute if needed</li>
<li>No sub-keys or nested structures allowed</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Correct: Plain vector</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> analysis.qmd</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> report.Rmd</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># Incorrect: Don't add sub-keys</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> analysis.qmd</span><span class="co">  # Wrong!</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="at">      </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Analysis"</span><span class="co">  # Wrong!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="practical-examples">Practical Examples<a class="anchor" aria-label="anchor" href="#practical-examples"></a>
</h3>
<p><strong>Example 1: Separate dev and production scripts</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> full-analysis.qmd</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> supplementary.Rmd</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> appendix.Rmd</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> quick-test.qmd</span><span class="co">  # Only build this during development</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Development build (uses dev.scripts)</span></span>
<span><span class="fu"><a href="../reference/projr_build_dev.html">projr_build_dev</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Only builds quick-test.qmd</span></span>
<span></span>
<span><span class="co"># Production build (uses build.scripts)</span></span>
<span><span class="fu"><a href="../reference/projr_build.html">projr_build_patch</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Builds all three documents</span></span></code></pre></div>
<p><strong>Example 2: Override Quarto project</strong></p>
<p>If you have a <code>_quarto.yml</code> that lists many documents but
only want to build specific ones:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> chapter1.qmd</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> chapter2.qmd</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">    # Chapters 3-10 will be skipped</span></span></code></pre></div>
<p><strong>Example 3: Use function parameters for one-off
builds</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build just one document, regardless of configuration</span></span>
<span><span class="fu"><a href="../reference/projr_build_dev.html">projr_build_dev</a></span><span class="op">(</span><span class="st">"exploratory-analysis.Rmd"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build multiple specific documents</span></span>
<span><span class="fu"><a href="../reference/projr_build_dev.html">projr_build_dev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"methods.Rmd"</span>, <span class="st">"results.Rmd"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="file-existence-validation">File Existence Validation<a class="anchor" aria-label="anchor" href="#file-existence-validation"></a>
</h3>
<p>Before any build starts, projr validates that all specified scripts
exist. If a script is missing, the build fails with a clear error
message.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In _projr.yml</span></span>
<span><span class="va">build</span><span class="op">:</span></span>
<span>  <span class="va">scripts</span><span class="op">:</span></span>
<span>    <span class="op">-</span> <span class="va">analysis.qmd</span></span>
<span>    <span class="op">-</span> <span class="va">missing.Rmd</span>  <span class="co"># This file doesn't exist</span></span>
<span></span>
<span><span class="fu"><a href="../reference/projr_build.html">projr_build_patch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Error: Script 'missing.Rmd' does not exist</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="build-hooks-configuration">Build Hooks Configuration<a class="anchor" aria-label="anchor" href="#build-hooks-configuration"></a>
</h2>
<p>Build hooks let you run custom R scripts at specific points in the
build process.</p>
<div class="section level3">
<h3 id="basic-structure-1">Basic Structure<a class="anchor" aria-label="anchor" href="#basic-structure-1"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> setup.R</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> download-data.R</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> cleanup.R</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> send-notifications.R</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="at">    </span><span class="fu">both</span><span class="kw">:</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> log-timestamp.R</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> dev-setup.R</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> dev-cleanup.R</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="at">    </span><span class="fu">both</span><span class="kw">:</span><span class="at"> dev-logger.R</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hook-stages">Hook Stages<a class="anchor" aria-label="anchor" href="#hook-stages"></a>
</h3>
<p>Hooks can run at three stages:</p>
<ul>
<li>
<strong><code>pre</code></strong> - Before the build starts (after
version bump, before Git commit)</li>
<li>
<strong><code>post</code></strong> - After the build completes
(after Git commit, before distributing to remotes)</li>
<li>
<strong><code>both</code></strong> - In both pre and post
stages</li>
</ul>
</div>
<div class="section level3">
<h3 id="key-behaviors-1">Key Behaviors<a class="anchor" aria-label="anchor" href="#key-behaviors-1"></a>
</h3>
<p><strong>Production builds</strong> use <code>build.hooks</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"check-credentials.R"</span><span class="kw">,</span><span class="at"> </span><span class="st">"setup-data.R"</span><span class="kw">]</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"compress-outputs.R"</span><span class="kw">]</span></span></code></pre></div>
<p><strong>Development builds</strong> use <code>dev.hooks</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> </span><span class="st">"dev-setup.R"</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> </span><span class="st">"dev-cleanup.R"</span></span></code></pre></div>
<p><strong>Important separation</strong>:</p>
<ul>
<li>
<code>build.hooks</code> are <strong>always ignored</strong> in
development builds</li>
<li>
<code>dev.hooks</code> are <strong>always ignored</strong> in
production builds</li>
<li>This ensures complete independence between development and
production workflows</li>
</ul>
</div>
<div class="section level3">
<h3 id="hook-execution-details">Hook Execution Details<a class="anchor" aria-label="anchor" href="#hook-execution-details"></a>
</h3>
<p><strong>Execution order</strong>:</p>
<p>Hooks within a stage run in the order listed in
<code>_projr.yml</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> first.R</span><span class="co">   # Runs first</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> second.R</span><span class="co">  # Runs second</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> third.R</span><span class="co">   # Runs third</span></span></code></pre></div>
<p><strong>Execution environment</strong>:</p>
<ul>
<li>Hooks run in an <strong>isolated child environment</strong> of the
global environment</li>
<li>Each hook gets its own fresh environment, preventing interference
between hooks</li>
<li>They have access to the project directory and all installed
packages</li>
<li>Objects created in one hook are not available to subsequent
hooks</li>
<li>This isolation prevents hooks from cluttering the global
environment</li>
</ul>
<p><strong>Execution timing</strong>:</p>
<pre><code>Production Build Flow:
1. ▶ Run pre-build hooks ◀
2. Bump version (e.g., 0.0.1 → 0.0.2)
3. Clear output directories (if configured)
4. Git commit (if configured)
5. Build scripts (render documents)
6. Git commit build outputs (if configured)
7. Distribute to remotes (GitHub, OSF, local)
8. ▶ Run post-build hooks ◀

Development Build Flow:
1. ▶ Run dev pre-build hooks ◀
2. Clear output directories (if configured)
3. Build scripts (render documents)
4. ▶ Run dev post-build hooks ◀
5. (No Git commit or version bump)</code></pre>
</div>
<div class="section level3">
<h3 id="file-format-requirements-1">File Format Requirements<a class="anchor" aria-label="anchor" href="#file-format-requirements-1"></a>
</h3>
<ul>
<li>Hooks must be specified as <strong>plain character
vectors</strong>
</li>
<li>File paths are relative to the project root</li>
<li>Paths can be absolute if needed</li>
<li>No sub-keys or nested structures allowed</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Correct: Plain vector</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> setup.R</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># Correct: Single file as string</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> cleanup.R</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co"># Incorrect: Don't add sub-keys</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> setup.R</span><span class="co">   # Wrong!</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="at">        </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Setup"</span><span class="co">  # Wrong!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="practical-examples-1">Practical Examples<a class="anchor" aria-label="anchor" href="#practical-examples-1"></a>
</h3>
<p><strong>Example 1: Data preparation hook</strong></p>
<p>Create a pre-build hook to download and prepare data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/prepare-data.R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Downloading data..."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download data from remote source</span></span>
<span><span class="va">data_url</span> <span class="op">&lt;-</span> <span class="st">"https://example.com/data.csv"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">data_url</span>, destfile <span class="op">=</span> <span class="st">"_raw_data/data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"_raw_data/data.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Data preparation complete"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> hooks/prepare-data.R</span></span></code></pre></div>
<p><strong>Example 2: Credential validation</strong></p>
<p>Check that required credentials are set before building:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/check-auth.R</span></span>
<span><span class="va">required_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GITHUB_PAT"</span>, <span class="st">"API_KEY"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">missing</span> <span class="op">&lt;-</span> <span class="va">required_vars</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="va">required_vars</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">missing</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span></span>
<span>    <span class="st">"Missing required environment variables: "</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">missing</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    <span class="st">"\nSee ?projr_env_set for setup instructions"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"All required credentials are set"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> hooks/check-auth.R</span></span></code></pre></div>
<p><strong>Example 3: Post-build notifications</strong></p>
<p>Send a notification when the build completes:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/notify.R</span></span>
<span><span class="va">version</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projr_version_get.html">projr_version_get</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Send email (pseudo-code)</span></span>
<span><span class="fu">send_email</span><span class="op">(</span></span>
<span>  to <span class="op">=</span> <span class="st">"team@example.com"</span>,</span>
<span>  subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Build completed:"</span>, <span class="va">version</span><span class="op">)</span>,</span>
<span>  body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Project built successfully at"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Notification sent"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> hooks/notify.R</span></span></code></pre></div>
<p><strong>Example 4: Timestamp logging in both stages</strong></p>
<p>Log timestamps before and after the build:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/timestamp.R</span></span>
<span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"_tmp/build_started.txt"</span><span class="op">)</span><span class="op">)</span> <span class="st">"POST"</span> <span class="kw">else</span> <span class="st">"PRE"</span></span>
<span></span>
<span><span class="va">log_msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="va">stage</span>, <span class="st">"build stage"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">stage</span> <span class="op">==</span> <span class="st">"PRE"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="st">"_tmp/build_started.txt"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"_tmp/build_started.txt"</span><span class="op">)</span></span>
<span>  <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">start_time</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">log_msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">log_msg</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"(%.1f seconds)"</span>, <span class="va">duration</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="st">"_tmp/build_started.txt"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">log_msg</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="at">    </span><span class="fu">both</span><span class="kw">:</span><span class="at"> hooks/timestamp.R</span></span></code></pre></div>
<p><strong>Example 5: Development-specific hooks</strong></p>
<p>Use different hooks for development and production:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/dev-setup.R</span></span>
<span><span class="co"># Lightweight setup for development</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Setting up development environment..."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>PROJR_OUTPUT_LEVEL <span class="op">=</span> <span class="st">"debug"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/prod-setup.R</span></span>
<span><span class="co"># More comprehensive setup for production</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Setting up production environment..."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate all credentials</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/check-auth.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download latest data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/prepare-data.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check disk space</span></span>
<span><span class="va">disk_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"df -h . | tail -1 | awk '{print $5}' | sed 's/%//'"</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">disk_space</span> <span class="op">&gt;</span> <span class="fl">90</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Insufficient disk space ("</span>, <span class="fl">100</span> <span class="op">-</span> <span class="va">disk_space</span>, <span class="st">"% free)"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> hooks/prod-setup.R</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> hooks/dev-setup.R</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="managing-hooks-with-r-functions">Managing Hooks with R Functions<a class="anchor" aria-label="anchor" href="#managing-hooks-with-r-functions"></a>
</h3>
<p>You can also manage hooks programmatically:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a pre-build hook</span></span>
<span><span class="fu"><a href="../reference/yml-hooks.html">projr_yml_hooks_add</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"setup.R"</span>, stage <span class="op">=</span> <span class="st">"pre"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a post-build hook</span></span>
<span><span class="fu"><a href="../reference/yml-hooks.html">projr_yml_hooks_add_post</a></span><span class="op">(</span><span class="st">"cleanup.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add multiple hooks</span></span>
<span><span class="fu"><a href="../reference/yml-hooks.html">projr_yml_hooks_add</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hook1.R"</span>, <span class="st">"hook2.R"</span>, <span class="st">"hook3.R"</span><span class="op">)</span>,</span>
<span>  stage <span class="op">=</span> <span class="st">"pre"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overwrite existing hooks (default behavior)</span></span>
<span><span class="fu"><a href="../reference/yml-hooks.html">projr_yml_hooks_add</a></span><span class="op">(</span><span class="st">"new-setup.R"</span>, stage <span class="op">=</span> <span class="st">"pre"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Append to existing hooks</span></span>
<span><span class="fu"><a href="../reference/yml-hooks.html">projr_yml_hooks_add</a></span><span class="op">(</span><span class="st">"additional.R"</span>, stage <span class="op">=</span> <span class="st">"pre"</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove all hooks</span></span>
<span><span class="fu"><a href="../reference/yml-hooks.html">projr_yml_hooks_rm_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="file-existence-validation-1">File Existence Validation<a class="anchor" aria-label="anchor" href="#file-existence-validation-1"></a>
</h3>
<p>Like scripts, hooks are validated before the build starts. If a hook
file is missing, the build fails immediately:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In _projr.yml</span></span>
<span><span class="va">build</span><span class="op">:</span></span>
<span>  <span class="va">hooks</span><span class="op">:</span></span>
<span>    <span class="va">pre</span><span class="op">:</span> <span class="va">missing</span><span class="op">-</span><span class="va">hook.R</span></span>
<span></span>
<span><span class="fu"><a href="../reference/projr_build.html">projr_build_patch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Error: Hook 'missing-hook.R' does not exist.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-patterns">Common Patterns<a class="anchor" aria-label="anchor" href="#common-patterns"></a>
</h2>
<div class="section level3">
<h3 id="pattern-1-fast-development-comprehensive-production">Pattern 1: Fast Development, Comprehensive Production<a class="anchor" aria-label="anchor" href="#pattern-1-fast-development-comprehensive-production"></a>
</h3>
<p>Build only essential documents during development, but build
everything for releases:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> introduction.qmd</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> methods.qmd</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> results.qmd</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> discussion.qmd</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> appendix.qmd</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> results.qmd</span><span class="co">  # Only rebuild results during development</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pattern-2-environment-specific-setup">Pattern 2: Environment-Specific Setup<a class="anchor" aria-label="anchor" href="#pattern-2-environment-specific-setup"></a>
</h3>
<p>Use hooks to configure the environment differently for development
and production:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> hooks/prod-setup.R</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> hooks/prod-cleanup.R</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> hooks/dev-setup.R</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="co">    # No cleanup hook for dev (faster iteration)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pattern-3-validation-pipeline">Pattern 3: Validation Pipeline<a class="anchor" aria-label="anchor" href="#pattern-3-validation-pipeline"></a>
</h3>
<p>Use hooks to validate inputs before building and outputs after
building:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/validate-credentials.R</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/validate-data.R</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/check-dependencies.R</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/validate-outputs.R</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/check-file-sizes.R</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/run-tests.R</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pattern-4-data-synchronization">Pattern 4: Data Synchronization<a class="anchor" aria-label="anchor" href="#pattern-4-data-synchronization"></a>
</h3>
<p>Keep data synchronized with remote sources:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/download-latest-data.R</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/update-models.R</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/upload-results.R</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pattern-5-conditional-hooks">Pattern 5: Conditional Hooks<a class="anchor" aria-label="anchor" href="#pattern-5-conditional-hooks"></a>
</h3>
<p>Create hooks that behave differently based on environment variables
or build state:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/conditional-setup.R</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"SKIP_DATA_DOWNLOAD"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Skipping data download (SKIP_DATA_DOWNLOAD is set)"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Downloading data..."</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/download-data.R"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check if this is a major version bump</span></span>
<span><span class="va">version</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projr_version_get.html">projr_version_get</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">is_major</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">endsWith</a></span><span class="op">(</span><span class="va">version</span>, <span class="st">".0.0"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">is_major</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Major release detected - running full validation"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/comprehensive-validation.R"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<div class="section level3">
<h3 id="scripts">Scripts<a class="anchor" aria-label="anchor" href="#scripts"></a>
</h3>
<p><strong>Be explicit when needed:</strong></p>
<ul>
<li>Use <code>build.scripts</code> when you have specific build
requirements</li>
<li>Use <code>dev.scripts</code> to speed up development by building
only what you’re actively working on</li>
<li>Rely on auto-detection for simple projects with obvious
structure</li>
</ul>
<p><strong>Keep paths relative:</strong></p>
<ul>
<li>Use project-relative paths (e.g., <code>analysis/report.Rmd</code>)
for portability</li>
<li>Avoid absolute paths unless necessary</li>
</ul>
<p><strong>Validate your configuration:</strong></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check that your configuration is valid</span></span>
<span><span class="fu"><a href="../reference/projr_yml_check.html">projr_yml_check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View what would be built</span></span>
<span><span class="fu"><a href="../reference/projr_build_dev.html">projr_build_dev</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Runs without committing</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hooks">Hooks<a class="anchor" aria-label="anchor" href="#hooks"></a>
</h3>
<p><strong>Keep hooks focused:</strong></p>
<ul>
<li>Each hook should do one thing well</li>
<li>Break complex operations into multiple hook files</li>
<li>Use descriptive names (e.g., <code>validate-credentials.R</code>,
not <code>hook1.R</code>)</li>
</ul>
<p><strong>Handle errors gracefully:</strong></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good: Provide helpful error messages</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"_raw_data/data.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span></span>
<span>    <span class="st">"Required data file not found: _raw_data/data.csv\n"</span>,</span>
<span>    <span class="st">"Run download-data.R first or check your data source"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Good: Use tryCatch for external operations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">destfile</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Failed to download data: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Provide feedback:</strong></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good: Show progress</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Starting credential validation..."</span><span class="op">)</span></span>
<span><span class="co"># ... validation code ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ All credentials validated"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Good: Show what's happening</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Downloading data from "</span>, <span class="va">url</span>, <span class="st">"..."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">destfile</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ Downloaded "</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">destfile</span><span class="op">)</span>, <span class="st">" bytes"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Test hooks independently:</strong></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># You can test hooks by sourcing them directly</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/validate-credentials.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or use them in an interactive session</span></span>
<span><span class="fu"><a href="../reference/projr_env_set.html">projr_env_set</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Load environment variables</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/prepare-data.R"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Use environment variables for configuration:</strong></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: hooks/download-data.R</span></span>
<span><span class="va">data_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DATA_URL"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="va">data_url</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"DATA_URL environment variable not set"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">data_url</span>, <span class="st">"_raw_data/data.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="co"># _environment</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="va">DATA_URL</span><span class="op">=</span>https://example.com/data.csv</span></code></pre></div>
<p><strong>Document your hooks:</strong></p>
<p>Add comments at the top of each hook file explaining its purpose:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/validate-credentials.R</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Purpose: Validate that all required credentials are set</span></span>
<span><span class="co"># Stage: pre-build</span></span>
<span><span class="co"># Required environment variables:</span></span>
<span><span class="co">#   - GITHUB_PAT: GitHub personal access token</span></span>
<span><span class="co">#   - API_KEY: External API key</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># This hook stops the build if any required credentials are missing,</span></span>
<span><span class="co"># preventing partial builds with incomplete data access.</span></span>
<span></span>
<span><span class="va">required_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GITHUB_PAT"</span>, <span class="st">"API_KEY"</span><span class="op">)</span></span>
<span><span class="co"># ... validation code ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="organization">Organization<a class="anchor" aria-label="anchor" href="#organization"></a>
</h3>
<p><strong>Use a dedicated hooks directory:</strong></p>
<pre><code>my-project/
├── hooks/
│   ├── pre-build/
│   │   ├── 01-validate-credentials.R
│   │   ├── 02-download-data.R
│   │   └── 03-check-dependencies.R
│   ├── post-build/
│   │   ├── 01-validate-outputs.R
│   │   └── 02-send-notifications.R
│   └── both/
│       └── timestamp.R
└── _projr.yml</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/pre-build/01-validate-credentials.R</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/pre-build/02-download-data.R</span></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/pre-build/03-check-dependencies.R</span></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/post-build/01-validate-outputs.R</span></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/post-build/02-send-notifications.R</span></span></code></pre></div>
<p><strong>Version control:</strong></p>
<ul>
<li>Commit hook scripts to version control</li>
<li>Document hook requirements in README</li>
<li>Include example environment files showing required variables</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="common-pitfalls">Common Pitfalls<a class="anchor" aria-label="anchor" href="#common-pitfalls"></a>
</h2>
<div class="section level3">
<h3 id="scripts-1">Scripts<a class="anchor" aria-label="anchor" href="#scripts-1"></a>
</h3>
<p><strong>Pitfall 1: Forgetting dev.scripts is exclusive</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co"># This configuration:</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> analysis.qmd</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> report.Rmd</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> quick-test.qmd</span></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a><span class="co"># Means:</span></span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a><span class="co"># - Production builds: analysis.qmd + report.Rmd</span></span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a><span class="co"># - Development builds: ONLY quick-test.qmd (build.scripts ignored)</span></span></code></pre></div>
<p>If you want <code>dev.scripts</code> to <em>add</em> to
<code>build.scripts</code>, you must list all files:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> analysis.qmd</span><span class="co">    # Must repeat</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> report.Rmd</span><span class="co">      # Must repeat</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> quick-test.qmd</span><span class="co">  # Additional file</span></span></code></pre></div>
<p><strong>Pitfall 2: Using sub-keys in scripts</strong></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="co"># Wrong: Don't add sub-keys</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> analysis.qmd</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a><span class="at">      </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Analysis"</span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a><span class="co"># Correct: Plain vector</span></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> analysis.qmd</span></span></code></pre></div>
<p><strong>Pitfall 3: Absolute paths reduce portability</strong></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="co"># Less portable</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> /home/user/project/analysis.qmd</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a><span class="co"># More portable</span></span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a><span class="at">  </span><span class="fu">scripts</span><span class="kw">:</span></span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> analysis.qmd</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hooks-1">Hooks<a class="anchor" aria-label="anchor" href="#hooks-1"></a>
</h3>
<p><strong>Pitfall 1: Expecting shared state between hooks</strong></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/setup.R</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hooks/process.R</span></span>
<span><span class="co"># Error: my_data doesn't exist!</span></span>
<span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">)</span></span></code></pre></div>
<p><strong>Solution</strong>: Save to disk or re-load in each hook:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/setup.R</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="st">"_tmp/data.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hooks/process.R</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"_tmp/data.rds"</span><span class="op">)</span></span>
<span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">)</span></span></code></pre></div>
<p><strong>Pitfall 2: Forgetting hooks are
environment-separate</strong></p>
<p>Hooks don’t have access to objects created during the build
process:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Your analysis.Rmd creates an object:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">expensive_analysis</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hooks/post-build.R</span></span>
<span><span class="co"># Error: results doesn't exist!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p><strong>Solution</strong>: Save objects in the analysis, load in the
hook:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In analysis.Rmd</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">expensive_analysis</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">results</span>, <span class="st">"_output/results.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hooks/post-build.R</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"_output/results.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p><strong>Pitfall 3: Not handling hook failures</strong></p>
<p>If a hook fails, the entire build stops:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/download.R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">destfile</span><span class="op">)</span>  <span class="co"># If this fails, build stops</span></span></code></pre></div>
<p><strong>Solution</strong>: Add error handling:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/download.R</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">destfile</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Using cached data file"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">destfile</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Data downloaded successfully"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span></span>
<span>        <span class="st">"Failed to download required data from "</span>, <span class="va">url</span>, <span class="st">"\n"</span>,</span>
<span>        <span class="st">"Error: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span>,</span>
<span>        <span class="st">"Please check your internet connection and data source"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Pitfall 4: Mixing build.hooks and dev.hooks
expectations</strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="co"># Wrong expectation: "dev builds will use build.hooks"</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> setup-production-data.R</span><span class="co">  # Downloads 10GB of data</span></span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a><span class="co">  # I didn't specify dev.hooks, so dev builds will be slow!</span></span></code></pre></div>
<p><strong>Solution</strong>: Specify lightweight dev hooks:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> setup-production-data.R</span></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span><span class="at"> setup-dev-data.R</span><span class="co">  # Uses cached or sample data</span></span></code></pre></div>
<p><strong>Pitfall 5: Using sub-keys in hooks</strong></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="co"># Wrong: Don't add sub-keys</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> setup.R</span></span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a><span class="at">        </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Setup script"</span></span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a><span class="co"># Correct: Plain vector</span></span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> setup.R</span></span></code></pre></div>
<p><strong>Pitfall 6: File paths relative to wrong
directory</strong></p>
<p>Hooks run with the project root as the working directory:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correct: Relative to project root</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"_raw_data/data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wrong: Relative to hooks directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../raw_data/data.csv"</span><span class="op">)</span>  <span class="co"># Assumes hook is in hooks/</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="validation-and-debugging">Validation and Debugging<a class="anchor" aria-label="anchor" href="#validation-and-debugging"></a>
</h2>
<div class="section level3">
<h3 id="check-your-configuration">Check Your Configuration<a class="anchor" aria-label="anchor" href="#check-your-configuration"></a>
</h3>
<p>Before building, verify your configuration is correct:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate entire configuration</span></span>
<span><span class="fu"><a href="../reference/projr_yml_check.html">projr_yml_check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check what scripts would be built</span></span>
<span><span class="fu"><a href="../reference/projr_build_dev.html">projr_build_dev</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Development build (doesn't commit)</span></span>
<span><span class="fu"><a href="../reference/projr_build.html">projr_build_patch</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Production build (commits with version bump)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="debug-hook-execution">Debug Hook Execution<a class="anchor" aria-label="anchor" href="#debug-hook-execution"></a>
</h3>
<p>To see which hooks are running:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set debug output level</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>PROJR_OUTPUT_LEVEL <span class="op">=</span> <span class="st">"debug"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run build - hooks will be logged</span></span>
<span><span class="fu"><a href="../reference/projr_build_dev.html">projr_build_dev</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Output: "Running dev hook: hooks/setup.R"</span></span>
<span><span class="co"># Output: "Running dev hook: hooks/timestamp.R"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test-hooks-independently">Test Hooks Independently<a class="anchor" aria-label="anchor" href="#test-hooks-independently"></a>
</h3>
<p>Run hooks outside the build process:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test a hook directly</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/validate-credentials.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up environment first if needed</span></span>
<span><span class="fu"><a href="../reference/projr_env_set.html">projr_env_set</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/download-data.R"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="view-configuration">View Configuration<a class="anchor" aria-label="anchor" href="#view-configuration"></a>
</h3>
<p>Examine your current configuration:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read _projr.yml</span></span>
<span><span class="va">yml</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="st">"_projr.yml"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check build scripts</span></span>
<span><span class="va">yml</span><span class="op">$</span><span class="va">build</span><span class="op">$</span><span class="va">scripts</span></span>
<span></span>
<span><span class="co"># Check build hooks</span></span>
<span><span class="va">yml</span><span class="op">$</span><span class="va">build</span><span class="op">$</span><span class="va">hooks</span></span>
<span></span>
<span><span class="co"># Check dev configuration</span></span>
<span><span class="va">yml</span><span class="op">$</span><span class="va">dev</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="integration-with-other-features">Integration with Other Features<a class="anchor" aria-label="anchor" href="#integration-with-other-features"></a>
</h2>
<div class="section level3">
<h3 id="environment-variables">Environment Variables<a class="anchor" aria-label="anchor" href="#environment-variables"></a>
</h3>
<p>Combine hooks with environment variables for flexible
configuration:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="co"># _environment</span></span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>DATA_SOURCE<span class="ot">=</span>https<span class="sc">:</span><span class="er">//</span>api.example.com<span class="sc">/</span>data</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>API_KEY<span class="ot">=</span>your_key_here</span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a><span class="co"># hooks/download.R</span></span>
<span id="cb59-6"><a href="#cb59-6" tabindex="-1"></a>source_url <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"DATA_SOURCE"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" tabindex="-1"></a>api_key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"API_KEY"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">nzchar</span>(source_url)) {</span>
<span id="cb59-10"><a href="#cb59-10" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"DATA_SOURCE environment variable not set"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" tabindex="-1"></a>}</span>
<span id="cb59-12"><a href="#cb59-12" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" tabindex="-1"></a><span class="co"># Download using credentials</span></span>
<span id="cb59-14"><a href="#cb59-14" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb59-15"><a href="#cb59-15" tabindex="-1"></a>  <span class="fu">paste0</span>(source_url, <span class="st">"?key="</span>, api_key),</span>
<span id="cb59-16"><a href="#cb59-16" tabindex="-1"></a>  <span class="st">"_raw_data/data.csv"</span></span>
<span id="cb59-17"><a href="#cb59-17" tabindex="-1"></a>)</span></code></pre></div>
<p>See <code><a href="../articles/environment.html">vignette("environment")</a></code> for details on environment
variables.</p>
</div>
<div class="section level3">
<h3 id="git-integration">Git Integration<a class="anchor" aria-label="anchor" href="#git-integration"></a>
</h3>
<p>Hooks run at specific points relative to Git operations:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a><span class="at">  </span><span class="fu">git</span><span class="kw">:</span></span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a><span class="at">    </span><span class="fu">commit</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a><span class="at">    </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> validate.R</span><span class="co">  # Runs after version bump, BEFORE Git commit</span></span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span></span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> notify.R</span><span class="co">    # Runs AFTER Git commit, before push</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="remote-destinations">Remote Destinations<a class="anchor" aria-label="anchor" href="#remote-destinations"></a>
</h3>
<p>Post-build hooks run before distributing to remotes:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> hooks/prepare-for-upload.R</span></span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a><span class="at">  </span><span class="fu">github</span><span class="kw">:</span></span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a><span class="at">    </span><span class="fu">send</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb61-6"><a href="#cb61-6" tabindex="-1"></a><span class="at">  </span><span class="fu">osf</span><span class="kw">:</span></span>
<span id="cb61-7"><a href="#cb61-7" tabindex="-1"></a><span class="at">    </span><span class="fu">send</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb61-8"><a href="#cb61-8" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" tabindex="-1"></a><span class="co"># Execution order:</span></span>
<span id="cb61-10"><a href="#cb61-10" tabindex="-1"></a><span class="co"># 1. Build completes</span></span>
<span id="cb61-11"><a href="#cb61-11" tabindex="-1"></a><span class="co"># 2. Git commit</span></span>
<span id="cb61-12"><a href="#cb61-12" tabindex="-1"></a><span class="co"># 3. Post-build hooks run</span></span>
<span id="cb61-13"><a href="#cb61-13" tabindex="-1"></a><span class="co"># 4. Push to GitHub</span></span>
<span id="cb61-14"><a href="#cb61-14" tabindex="-1"></a><span class="co"># 5. Upload to OSF</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="profiles">Profiles<a class="anchor" aria-label="anchor" href="#profiles"></a>
</h3>
<p>Both scripts and hooks support profiles:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a profile with specific hooks</span></span>
<span><span class="fu"><a href="../reference/projr_profile_create.html">projr_profile_create</a></span><span class="op">(</span><span class="st">"production"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add hooks to that profile</span></span>
<span><span class="fu"><a href="../reference/yml-hooks.html">projr_yml_hooks_add</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="st">"hooks/production-setup.R"</span>,</span>
<span>  stage <span class="op">=</span> <span class="st">"pre"</span>,</span>
<span>  profile <span class="op">=</span> <span class="st">"production"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the profile</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>PROJR_PROFILE <span class="op">=</span> <span class="st">"production"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/projr_build.html">projr_build_patch</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-examples">Advanced Examples<a class="anchor" aria-label="anchor" href="#advanced-examples"></a>
</h2>
<div class="section level3">
<h3 id="example-1-conditional-data-download">Example 1: Conditional Data Download<a class="anchor" aria-label="anchor" href="#example-1-conditional-data-download"></a>
</h3>
<p>Download data only if it’s outdated:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/smart-download.R</span></span>
<span><span class="va">data_file</span> <span class="op">&lt;-</span> <span class="st">"_raw_data/data.csv"</span></span>
<span><span class="va">max_age_hours</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span></span>
<span><span class="va">should_download</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">data_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">file_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">data_file</span><span class="op">)</span><span class="op">$</span><span class="va">mtime</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"hours"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">file_age</span> <span class="op">&lt;</span> <span class="va">max_age_hours</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Using cached data ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">file_age</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">" hours old)"</span><span class="op">)</span></span>
<span>    <span class="va">should_download</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">should_download</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Downloading fresh data..."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DATA_URL"</span><span class="op">)</span>,</span>
<span>    <span class="va">data_file</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ Data downloaded"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-multi-stage-data-pipeline">Example 2: Multi-Stage Data Pipeline<a class="anchor" aria-label="anchor" href="#example-2-multi-stage-data-pipeline"></a>
</h3>
<p>Set up a complex data pipeline with multiple hooks:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a><span class="at">    </span><span class="fu">pre</span><span class="kw">:</span></span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/01-validate-environment.R</span></span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/02-download-raw-data.R</span></span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/03-validate-raw-data.R</span></span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/04-preprocess-data.R</span></span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> hooks/05-validate-processed-data.R</span></span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/01-validate-environment.R</span></span>
<span><span class="va">required_packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"tidyr"</span><span class="op">)</span></span>
<span><span class="va">missing</span> <span class="op">&lt;-</span> <span class="va">required_packages</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">required_packages</span>, <span class="va">requireNamespace</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">missing</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Missing required packages: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">missing</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># hooks/02-download-raw-data.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"hooks/smart-download.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hooks/03-validate-raw-data.R</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"_raw_data/data.csv"</span><span class="op">)</span></span>
<span><span class="va">required_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"date"</span>, <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="va">missing_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">required_cols</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">missing_cols</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Data missing required columns: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">missing_cols</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Data file is empty"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ Raw data validated ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="st">" rows)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hooks/04-preprocess-data.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"_raw_data/data.csv"</span><span class="op">)</span></span>
<span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">processed</span>, <span class="st">"_raw_data/processed.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ Data preprocessed ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">processed</span><span class="op">)</span>, <span class="st">" rows)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hooks/05-validate-processed-data.R</span></span>
<span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"_raw_data/processed.rds"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">processed</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Processed data contains invalid dates"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ Processed data validated"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-automated-testing">Example 3: Automated Testing<a class="anchor" aria-label="anchor" href="#example-3-automated-testing"></a>
</h3>
<p>Run tests as a post-build hook:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/run-tests.R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Running post-build tests..."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_dir</span> <span class="op">&lt;-</span> <span class="st">"tests/integration"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">test_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"No integration tests found"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">test_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">test_dir</span>, pattern <span class="op">=</span> <span class="st">"\\.R$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">failed_tests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">test_file</span> <span class="kw">in</span> <span class="va">test_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Running "</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">test_file</span><span class="op">)</span>, <span class="st">"..."</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">test_file</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">test_file</span><span class="op">)</span>, <span class="st">" passed"</span><span class="op">)</span></span>
<span>      <span class="cn">TRUE</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✗ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">test_file</span><span class="op">)</span>, <span class="st">" failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>      <span class="cn">FALSE</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">result</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">failed_tests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">failed_tests</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">test_file</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">failed_tests</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span></span>
<span>    <span class="st">"Build tests failed: "</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">failed_tests</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    <span class="st">"\nPlease fix errors before releasing"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ All build tests passed"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="co"># _projr.yml</span></span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a><span class="at">  </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a><span class="at">    </span><span class="fu">post</span><span class="kw">:</span><span class="at"> hooks/run-tests.R</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-4-build-notifications-with-status">Example 4: Build Notifications with Status<a class="anchor" aria-label="anchor" href="#example-4-build-notifications-with-status"></a>
</h3>
<p>Send different notifications based on build success:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hooks/notify.R</span></span>
<span><span class="va">version</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projr_version_get.html">projr_version_get</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y-%m-%d %H:%M:%S"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check if build was successful by looking for expected outputs</span></span>
<span><span class="va">outputs_dir</span> <span class="op">&lt;-</span> <span class="st">"_output"</span></span>
<span><span class="va">expected_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"report.html"</span>, <span class="st">"figures/plot.png"</span>, <span class="st">"tables/results.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_exist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputs_dir</span>, <span class="va">expected_files</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">all_exist</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"SUCCESS"</span></span>
<span>  <span class="va">message_body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"Build"</span>, <span class="va">version</span>, <span class="st">"completed successfully at"</span>, <span class="va">timestamp</span>,</span>
<span>    <span class="st">"\nAll expected outputs generated"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"WARNING"</span></span>
<span>  <span class="va">missing</span> <span class="op">&lt;-</span> <span class="va">expected_files</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputs_dir</span>, <span class="va">expected_files</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">message_body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"Build"</span>, <span class="va">version</span>, <span class="st">"completed with warnings at"</span>, <span class="va">timestamp</span>,</span>
<span>    <span class="st">"\nMissing outputs:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">missing</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Log to file</span></span>
<span><span class="va">log_file</span> <span class="op">&lt;-</span> <span class="st">"_tmp/build-notifications.log"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">timestamp</span>, <span class="va">status</span>, <span class="va">version</span>, <span class="st">"\n"</span><span class="op">)</span>, file <span class="op">=</span> <span class="va">log_file</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Send notification (pseudo-code)</span></span>
<span><span class="co"># send_notification(</span></span>
<span><span class="co">#   title = paste("Build", status, "-", version),</span></span>
<span><span class="co">#   body = message_body</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"✓ Notification logged: "</span>, <span class="va">status</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li>
<code><a href="../reference/yml-hooks.html">?projr_yml_hooks_add</a></code> - Add hooks programmatically</li>
<li>
<code><a href="../reference/projr_build_dev.html">?projr_build_dev</a></code> - Development builds</li>
<li>
<code><a href="../reference/projr_build.html">?projr_build_patch</a></code> - Production builds</li>
<li>
<code><a href="../articles/environment.html">vignette("environment")</a></code> - Environment variables</li>
<li>
<code><a href="../articles/how-to-guides.html">vignette("how-to-guides")</a></code> - Step-by-step guides</li>
<li>
<code><a href="../articles/concepts.html">vignette("concepts")</a></code> - Core concepts</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miguel Rodo. Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> and R</p>
</div>

<div class="pkgdown-footer-right">
  <p><a href="LICENSE.html">License</a> • projr is free and open source software</p>
</div>

    </footer>
</div>





  </body>
</html>
