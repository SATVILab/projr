---
title: "Directory Licenses"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Directory Licenses}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

The `projr` package allows you to automatically add license files to specific directories in your project. This is particularly useful for:

- Licensing raw data separately from code
- Licensing outputs/results separately from code
- Licensing documentation separately from code
- Using different licenses for different parts of your project

## Setting Directory Licenses

You can set licenses for directories using the `projr_yml_dir_license_set()` function:

```{r eval=FALSE}
library(projr)

# Set a license for output directory (simple format)
projr_yml_dir_license_set("CC-BY", "output")

# Set a license for raw data with custom authors and year
projr_yml_dir_license_set(
  "MIT",
  "raw-data",
  authors = c("Jane Doe", "John Smith"),
  year = 2024
)

# Set a license for docs directory
projr_yml_dir_license_set("Apache-2.0", "docs")
```

## Supported License Types

The following license types are supported:

- **CC-BY** (Creative Commons Attribution 4.0) - Good for data and analysis projects
- **CC0** (Creative Commons Zero) - Dedicates to public domain
- **Apache-2.0** - Permissive with patent protection
- **MIT** - Simple permissive license
- **Proprietary** - Private code/data

Common variations are also accepted (e.g., "ccby", "apache", "mit").

## How It Works

When you run a build (`projr_build_dev()`, `projr_build_patch()`, etc.), `projr` will:

1. **Pre-build**: Create/update LICENSE files in input directories (raw-data, cache)
   - This happens for ALL builds, including dev builds
   - LICENSE files are ONLY created/updated if a license config exists in `_projr.yml`
   - If no config exists, existing LICENSE files are left untouched
   - This allows manual license creation and editing
2. **Post-build**: Create LICENSE files in output directories (output, docs, data)
   - Only happens for production builds (not dev builds)

The LICENSE files are automatically excluded from manifest tracking, so they won't be versioned with your project outputs.

### Two Approaches to Licensing

**Approach 1: YAML Configuration (Automatic)**
- Add license config to `_projr.yml` using `projr_yml_dir_license_set()`
- Licenses are automatically regenerated during builds
- Ensures consistency with project metadata
- Good for output directories and when you want automatic updates

**Approach 2: Manual Creation**
- Create licenses using `projr_license_create_manual()`
- Licenses are NOT managed by builds
- You can manually edit them
- They won't be overwritten unless you add YAML config
- Good for raw data directories with custom licensing needs

### Author Precedence

Authors are determined in the following order:
1. Authors explicitly specified in the directory's license configuration (highest priority)
2. Authors from the DESCRIPTION file
3. "Project Authors" as a fallback (lowest priority)

## Configuration Format

### Simple Format

Use just the license type. Authors and year are automatically determined:

```yaml
directories:
  output:
    path: _output
    license: CC-BY
```

### Full Format

Specify type, authors, and year explicitly:

```yaml
directories:
  raw-data:
    path: _raw_data
    license:
      type: MIT
      authors:
        - Jane Doe
        - John Smith
      year: 2024
```

## Checking and Removing Licenses

Get the current license configuration:

```{r eval=FALSE}
# Get license for a directory
projr_yml_dir_license_get("output")
```

Remove a license configuration:

```{r eval=FALSE}
# Remove license for a directory
projr_yml_dir_license_rm("output")
```

## Updating Licenses with DESCRIPTION Authors

If you update the authors in your DESCRIPTION file, you can propagate those changes to all LICENSE files:

```{r eval=FALSE}
# Update all directories with license configurations
projr_yml_dir_license_update()

# Update specific directories only
projr_yml_dir_license_update(c("raw-data", "output"))
```

This is particularly useful for:
- Updating author information after personnel changes
- Propagating authors to raw data directories (since they aren't regenerated on each build)
- Ensuring consistency across all LICENSE files in your project

## Example Workflow

Here's a typical workflow for setting up licenses:

```{r eval=FALSE}
# Initialize project
projr_init()

# Set licenses for different directories
projr_yml_dir_license_set("CC-BY", "output")
projr_yml_dir_license_set("CC0", "raw-data")
projr_yml_dir_license_set("Apache-2.0", "docs")

# Create some content
# ... your analysis code ...

# Run build - LICENSE files will be automatically created
projr_build_dev()
```

After the build, you'll find LICENSE files in:
- `_raw_data/LICENSE` (CC0)
- `_output/LICENSE` (CC-BY)
- `docs/LICENSE` (Apache-2.0)

## Manual License Creation

For situations where you want to create and manually edit licenses without them being overwritten during builds, use `projr_license_create_manual()`:

```{r eval=FALSE}
# Create a manual license in raw-data directory
projr_license_create_manual("MIT", "raw-data")

# Create in all raw data directories
projr_license_create_manual("CC-BY")

# With custom authors
projr_license_create_manual(
  "Apache-2.0",
  "raw-data",
  authors = c("Jane Doe", "John Smith"),
  year = 2024
)
```

**Key behaviors:**
- Licenses created this way are NOT added to `_projr.yml`
- They will NOT be overwritten during builds
- You can manually edit them without worrying about builds changing them
- If you later add a license config to YAML, it will override the manual license

This is useful when:
- You want to maintain custom license text
- Author lists are complex and change frequently
- You don't want builds to trigger new versions from minor license tweaks

## Best Practices

1. **Choose appropriate licenses**: Use CC-BY or CC0 for data, Apache-2.0 or MIT for code
2. **Decide on approach**:
   - Use YAML config for licenses that should stay in sync with project metadata
   - Use manual creation for licenses you want to customize and control
3. **Be consistent**: Use the same license type across similar directories
4. **Document your choices**: Explain why you chose particular licenses in your README

## Notes

- LICENSE files are automatically excluded from manifest tracking
- Default authors are taken from the DESCRIPTION file if available
- Default year is the current year
- License templates are stored in the package and can be customized
